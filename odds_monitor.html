<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>STGRadar — Comparador + Freebet</title>
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='85'>⚽</text></svg>" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet" />
  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    :root {
      --bg: #0d0f1a;
      --bg2: #13162a;
      --bg3: #1a1e35;
      --card: #1e2340;
      --card2: #252a4a;
      --border: rgba(255, 255, 255, 0.07);
      --accent: #6c63ff;
      --accent2: #a78bfa;
      --green: #22d3a7;
      --green-dim: rgba(34, 211, 167, 0.12);
      --yellow: #fbbf24;
      --orange: #fb923c;
      --orange-dim: rgba(251, 146, 60, 0.10);
      --purple: #a855f7;
      --purple-dim: rgba(168, 85, 247, 0.12);
      --red: #f87171;
      --text: #e2e8f0;
      --muted: #64748b;
      --radius: 12px;
    }

    html {
      font-size: 15px;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
    }

    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--card2);
      border-radius: 4px;
    }

    /* ── HEADER ── */
    header {
      background: linear-gradient(90deg, var(--bg2) 0%, #1a1040 100%);
      border-bottom: 1px solid var(--border);
      padding: 14px 24px;
      display: flex;
      align-items: center;
      gap: 14px;
      position: sticky;
      top: 0;
      z-index: 200;
      backdrop-filter: blur(12px);
    }

    .logo {
      font-size: 1.3rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--accent2), var(--green));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .tabs {
      display: flex;
      gap: 4px;
      background: var(--bg3);
      border-radius: 10px;
      padding: 3px;
    }

    .tab-btn {
      background: transparent;
      border: none;
      border-radius: 7px;
      padding: 7px 16px;
      font-family: 'Inter', sans-serif;
      font-size: 0.82rem;
      font-weight: 600;
      color: var(--muted);
      cursor: pointer;
      transition: all .2s;
      white-space: nowrap;
    }

    .tab-btn.ativo {
      background: var(--accent);
      color: #fff;
    }

    .tab-btn:not(.ativo):hover {
      color: var(--text);
    }

    .badge {
      background: var(--green-dim);
      color: var(--green);
      border: 1px solid rgba(34, 211, 167, .25);
      border-radius: 20px;
      padding: 3px 10px;
      font-size: .72rem;
      font-weight: 600;
    }

    .header-right {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #status-pill {
      font-size: .78rem;
      color: var(--muted);
    }

    #btn-atualizar {
      background: linear-gradient(135deg, var(--accent), #4f46e5);
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 7px 16px;
      font-family: 'Inter', sans-serif;
      font-size: .82rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity .2s, transform .1s;
    }

    #btn-atualizar:hover {
      opacity: .85;
      transform: translateY(-1px);
    }

    /* ── VIEWS ── */
    .view {
      display: none;
    }

    .view.ativo {
      display: flex;
      flex-direction: column;
    }

    /* ══════════════════════════════════
       COMPARADOR DE ODDS
    ══════════════════════════════════ */
    #view-comparador.ativo {
      flex-direction: row;
      height: calc(100vh - 57px);
    }

    .painel-jogos {
      width: 370px;
      flex-shrink: 0;
      border-right: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .painel-header {
      padding: 14px;
      border-bottom: 1px solid var(--border);
      background: var(--bg2);
    }

    .search-wrap {
      position: relative;
    }

    .search-wrap .icon {
      position: absolute;
      left: 11px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      pointer-events: none;
    }

    #busca-jogo {
      width: 100%;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      color: var(--text);
      padding: 9px 12px 9px 36px;
      font-family: 'Inter', sans-serif;
      font-size: .87rem;
      outline: none;
      transition: border-color .2s;
    }

    #busca-jogo:focus {
      border-color: var(--accent);
    }

    #busca-jogo::placeholder {
      color: var(--muted);
    }

    .filtro-comp {
      margin-top: 9px;
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
    }

    .chip {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 3px 11px;
      font-size: .71rem;
      font-weight: 500;
      color: var(--muted);
      cursor: pointer;
      transition: all .2s;
      white-space: nowrap;
    }

    .chip:hover,
    .chip.ativo {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
    }

    .contador-jogos {
      padding: 9px 14px 5px;
      font-size: .75rem;
      color: var(--muted);
    }

    .lista-jogos {
      overflow-y: auto;
      flex: 1;
    }

    .jogo-item {
      padding: 12px 14px;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: background .15s;
      position: relative;
    }

    .jogo-item:hover {
      background: var(--bg3);
    }

    .jogo-item.ativo {
      background: rgba(108, 99, 255, .1);
      border-left: 3px solid var(--accent);
    }

    .jogo-times {
      font-size: .88rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .jogo-meta {
      font-size: .73rem;
      color: var(--muted);
      display: flex;
      gap: 7px;
      flex-wrap: wrap;
    }

    .jogo-meta .hora {
      color: var(--yellow);
      font-weight: 600;
    }

    .jogo-odds-preview {
      display: flex;
      gap: 5px;
      margin-top: 6px;
    }

    .odd-pill {
      background: var(--card2);
      border-radius: 5px;
      padding: 3px 7px;
      font-size: .71rem;
      font-weight: 500;
      display: flex;
      gap: 3px;
    }

    .odd-pill .label {
      color: var(--muted);
    }

    .odd-pill .val {
      color: var(--green);
      font-weight: 700;
    }

    .casas-badge {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: var(--bg3);
      border: 1px solid var(--border);
      border-radius: 5px;
      padding: 3px 7px;
      font-size: .69rem;
      color: var(--muted);
    }

    .painel-detalhe {
      flex: 1;
      overflow-y: auto;
      padding: 22px;
      background: var(--bg);
    }

    .estado-vazio {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--muted);
      gap: 12px;
      text-align: center;
    }

    .estado-vazio .icone {
      font-size: 3rem;
      opacity: .4;
    }

    .estado-vazio p {
      font-size: .9rem;
      max-width: 280px;
      line-height: 1.5;
    }

    .detalhe-header {
      background: linear-gradient(135deg, var(--card), var(--card2));
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 20px 22px;
      margin-bottom: 18px;
    }

    .detalhe-partida {
      font-size: 1.35rem;
      font-weight: 800;
      margin-bottom: 5px;
    }

    .detalhe-meta {
      font-size: .81rem;
      color: var(--muted);
      display: flex;
      gap: 13px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    .tag-best {
      display: inline-flex;
      align-items: center;
      gap: 7px;
      background: var(--green-dim);
      border: 1px solid rgba(34, 211, 167, .2);
      border-radius: 10px;
      padding: 7px 13px;
      font-size: .81rem;
      flex-wrap: wrap;
    }

    .tag-best .label {
      color: var(--muted);
    }

    .tag-best .val {
      color: var(--green);
      font-weight: 700;
      font-size: .93rem;
    }

    .tag-best .casa {
      color: var(--accent2);
      font-size: .74rem;
    }

    .secao-titulo {
      display: flex;
      align-items: center;
      gap: 9px;
      margin-bottom: 9px;
      margin-top: 20px;
    }

    .secao-titulo:first-of-type {
      margin-top: 0;
    }

    .secao-titulo h3 {
      font-size: .77rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .8px;
    }

    .pill-normal {
      background: var(--green-dim);
      color: var(--green);
      border: 1px solid rgba(34, 211, 167, .25);
      border-radius: 20px;
      padding: 2px 9px;
      font-size: .69rem;
      font-weight: 600;
    }

    .pill-so {
      background: var(--orange-dim);
      color: var(--orange);
      border: 1px solid rgba(251, 146, 60, .25);
      border-radius: 20px;
      padding: 2px 9px;
      font-size: .69rem;
      font-weight: 600;
    }

    .secao-titulo .legenda {
      font-size: .72rem;
      color: var(--muted);
      font-weight: 400;
    }

    .tabela-wrap {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 13px;
      overflow: hidden;
      margin-bottom: 5px;
    }

    .tabela-wrap.so {
      border-color: rgba(251, 146, 60, .2);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead tr {
      background: var(--card2);
    }

    thead th {
      padding: 10px 15px;
      text-align: left;
      font-size: .74rem;
      font-weight: 600;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .5px;
      white-space: nowrap;
    }

    thead th.sortable {
      cursor: pointer;
      user-select: none;
      text-align: center;
      transition: color .15s;
    }

    thead th.sortable:hover {
      color: var(--text);
    }

    thead th.sort-asc,
    thead th.sort-desc {
      color: var(--green) !important;
    }

    .sort-icon {
      margin-left: 3px;
      font-size: .7rem;
      opacity: .5;
    }

    thead th.sort-asc .sort-icon,
    thead th.sort-desc .sort-icon {
      opacity: 1;
    }

    tbody tr {
      border-top: 1px solid var(--border);
      transition: background .12s;
    }

    tbody tr:hover {
      background: rgba(255, 255, 255, .03);
    }

    tbody tr.is-best {
      background: rgba(34, 211, 167, .04);
    }

    .tabela-wrap.so tbody tr.is-best {
      background: rgba(251, 146, 60, .05);
    }

    tbody tr.linha-topo-normal {
      background: rgba(34, 211, 167, .03) !important;
    }

    tbody tr.linha-topo-so {
      background: rgba(251, 146, 60, .04) !important;
    }

    td {
      padding: 11px 15px;
      font-size: .87rem;
    }

    .td-casa {
      display: flex;
      align-items: center;
      gap: 7px;
      font-weight: 600;
    }

    .dot-best {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--green);
      flex-shrink: 0;
      box-shadow: 0 0 6px var(--green);
    }

    .dot-best-so {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: var(--orange);
      flex-shrink: 0;
      box-shadow: 0 0 6px var(--orange);
    }

    .dot-normal {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .td-odd {
      text-align: center;
      font-weight: 700;
      font-size: .94rem;
      font-variant-numeric: tabular-nums;
    }

    .td-odd.melhor {
      color: var(--green);
    }

    .td-odd.melhor-so {
      color: var(--orange);
    }

    .td-odd.normal {
      color: var(--text);
    }

    .td-odd.zero {
      color: var(--muted);
      font-weight: 400;
      font-size: .79rem;
    }

    .td-odd.topo-normal {
      color: var(--green);
      font-size: 1.04rem;
      text-shadow: 0 0 10px rgba(34, 211, 167, .55);
      background: rgba(34, 211, 167, .08);
      border-radius: 5px;
    }

    .td-odd.topo-so {
      color: var(--orange);
      font-size: 1.04rem;
      text-shadow: 0 0 10px rgba(251, 146, 60, .55);
      background: rgba(251, 146, 60, .08);
      border-radius: 5px;
    }

    .btn-link {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: var(--bg3);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 4px 9px;
      font-size: .74rem;
      font-weight: 500;
      color: var(--accent2);
      text-decoration: none;
      transition: all .2s;
    }

    .btn-link:hover {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
      transform: translateY(-1px);
    }

    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 13px;
      padding: 50px 20px;
      color: var(--muted);
    }

    .spinner {
      width: 34px;
      height: 34px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin .8s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    /* ══════════════════════════════════
       EXTRAÇÃO FREEBET
    ══════════════════════════════════ */
    #view-freebet.ativo {
      flex-direction: column;
      min-height: calc(100vh - 57px);
    }

    .fb-wrapper {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 57px);
    }

    .fb-config {
      background: linear-gradient(135deg, var(--bg2), #12102a);
      border-bottom: 1px solid var(--border);
      padding: 18px 28px;
      flex-shrink: 0;
    }

    .fb-config-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 14px;
    }

    .fb-titulo {
      font-size: 1.1rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--purple), var(--accent2));
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .fb-casas-count {
      font-size: .8rem;
      color: var(--muted);
    }

    .fb-controles {
      display: flex;
      align-items: flex-end;
      gap: 14px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }

    .fb-campo {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .fb-campo label {
      font-size: .74rem;
      color: var(--muted);
      font-weight: 500;
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    .fb-input {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 9px;
      color: var(--text);
      padding: 9px 14px;
      font-family: 'Inter', sans-serif;
      font-size: .95rem;
      font-weight: 600;
      outline: none;
      transition: border-color .2s;
      width: 130px;
    }

    .fb-input:focus {
      border-color: var(--purple);
    }

    .fb-filtros-btn {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 9px;
      color: var(--muted);
      padding: 9px 16px;
      font-family: 'Inter', sans-serif;
      font-size: .83rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 7px;
      transition: all .2s;
      height: 40px;
    }

    .fb-filtros-btn:hover {
      border-color: var(--purple);
      color: var(--text);
    }

    .fb-filtros-btn.ativo {
      background: var(--purple-dim);
      border-color: var(--purple);
      color: var(--purple);
    }

    /* Grid de casas */
    .fb-casas-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 7px;
    }

    .fb-casa-btn {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--muted);
      padding: 7px 14px;
      font-family: 'Inter', sans-serif;
      font-size: .8rem;
      font-weight: 500;
      cursor: pointer;
      transition: all .2s;
      white-space: nowrap;
    }

    .fb-casa-btn:hover {
      border-color: var(--purple);
      color: var(--text);
    }

    .fb-casa-btn.ativo {
      background: var(--purple-dim);
      border-color: var(--purple);
      color: var(--purple);
      font-weight: 700;
    }

    /* Painel filtros */
    .fb-filtros-painel {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 18px;
      margin-top: 12px;
      display: none;
      gap: 24px;
      flex-wrap: wrap;
    }

    .fb-filtros-painel.aberto {
      display: flex;
    }

    .fb-filtro-grupo {
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-width: 180px;
    }

    .fb-filtro-grupo label {
      font-size: .73rem;
      color: var(--muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    .fb-filtro-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .fb-filtro-row span {
      font-size: .82rem;
      color: var(--text);
    }

    .fb-mini-input {
      background: var(--bg3);
      border: 1px solid var(--border);
      border-radius: 7px;
      color: var(--text);
      padding: 6px 10px;
      font-family: 'Inter', sans-serif;
      font-size: .82rem;
      outline: none;
      width: 90px;
      transition: border-color .2s;
    }

    .fb-mini-input:focus {
      border-color: var(--purple);
    }

    /* Resultados Freebet */
    .fb-resultados-area {
      flex: 1;
      overflow-y: auto;
      padding: 22px 28px;
    }

    .fb-placeholder {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100%;
      color: var(--muted);
      gap: 14px;
      text-align: center;
    }

    .fb-placeholder .icon {
      font-size: 3.5rem;
      opacity: .35;
    }

    .fb-placeholder h3 {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--text);
      opacity: .6;
    }

    .fb-placeholder p {
      font-size: .87rem;
      max-width: 320px;
      line-height: 1.6;
    }

    .fb-resultados-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 18px;
    }

    .fb-resultados-info {
      font-size: .82rem;
      color: var(--muted);
    }

    .fb-resultados-info strong {
      color: var(--green);
    }

    .fb-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(330px, 1fr));
      gap: 14px;
    }

    /* Card Freebet */
    .fb-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 14px;
      overflow: hidden;
      transition: transform .15s, border-color .2s;
    }

    .fb-card:hover {
      transform: translateY(-2px);
      border-color: rgba(168, 85, 247, .25);
    }

    .fb-card-header {
      padding: 14px 16px;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 10px;
    }

    .fb-match-icon {
      font-size: 1rem;
      flex-shrink: 0;
      margin-top: 1px;
    }

    .fb-match-info {
      flex: 1;
      min-width: 0;
    }

    .fb-match-name {
      font-size: .93rem;
      font-weight: 700;
      line-height: 1.3;
      margin-bottom: 3px;
    }

    .fb-match-comp {
      font-size: .72rem;
      color: var(--muted);
    }

    .fb-roi-badge {
      border-radius: 8px;
      padding: 5px 10px;
      font-size: .8rem;
      font-weight: 800;
      white-space: nowrap;
      flex-shrink: 0;
    }

    .fb-roi-badge.alto {
      background: rgba(34, 211, 167, .15);
      color: var(--green);
      border: 1px solid rgba(34, 211, 167, .3);
    }

    .fb-roi-badge.medio {
      background: rgba(251, 191, 36, .12);
      color: var(--yellow);
      border: 1px solid rgba(251, 191, 36, .25);
    }

    .fb-roi-badge.baixo {
      background: rgba(100, 116, 139, .12);
      color: var(--muted);
      border: 1px solid var(--border);
    }

    .fb-card-summary {
      padding: 10px 16px;
      background: var(--bg3);
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      font-size: .8rem;
      color: var(--muted);
      border-top: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
    }

    .fb-card-summary span strong {
      color: var(--text);
    }

    .fb-lucro-val {
      color: var(--green) !important;
    }

    .fb-card-bets {
      padding: 10px 0;
    }

    .fb-bet {
      display: grid;
      grid-template-columns: 1fr auto auto auto;
      align-items: center;
      padding: 9px 16px;
      gap: 10px;
      border-bottom: 1px solid var(--border);
      font-size: .82rem;
    }

    .fb-bet:last-child {
      border-bottom: none;
    }

    .fb-bet-casa {
      font-weight: 600;
    }

    .fb-bet-outcome {
      color: var(--muted);
      font-size: .75rem;
    }

    .fb-bet-odd {
      font-variant-numeric: tabular-nums;
      color: var(--muted);
      font-size: .78rem;
    }

    .fb-bet-odd span {
      color: var(--text);
      font-weight: 600;
    }

    .fb-bet-valor {
      font-weight: 700;
      color: var(--green);
      font-variant-numeric: tabular-nums;
      white-space: nowrap;
    }

    /* linha da freebet */
    .fb-bet.is-freebet {
      background: rgba(168, 85, 247, .06);
    }

    .fb-bet.is-freebet .fb-bet-casa {
      color: var(--purple);
    }

    .fb-bet.is-freebet .fb-bet-valor {
      color: var(--purple);
    }

    .fb-freebet-tag {
      background: var(--purple-dim);
      color: var(--purple);
      border: 1px solid rgba(168, 85, 247, .3);
      border-radius: 5px;
      padding: 1px 6px;
      font-size: .65rem;
      font-weight: 700;
      margin-left: 4px;
      vertical-align: middle;
    }

    .fb-casa-dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--purple);
      display: inline-block;
      margin-right: 4px;
      box-shadow: 0 0 5px var(--purple);
    }

    @media (max-width:840px) {
      #view-comparador.ativo {
        flex-direction: column;
      }

      .painel-jogos {
        width: 100%;
        height: 50vh;
        border-right: none;
        border-bottom: 1px solid var(--border);
      }
    }
  </style>
</head>

<body>

  <!-- ═══ HEADER ═══ -->
  <header>
    <div class="logo">⚡ STGRadar</div>
    <div class="tabs">
      <button class="tab-btn ativo" id="tab-comparador" onclick="mudarAba('comparador')">Comparador de Odds</button>
      <button class="tab-btn" id="tab-freebet" onclick="mudarAba('freebet')">🎟️ Extração Freebet</button>
    </div>
    <div class="badge">AO VIVO</div>
    <div class="header-right">
      <span id="status-pill">Carregando...</span>
      <button id="btn-atualizar" onclick="carregarJogos()">↻ Atualizar</button>
    </div>
  </header>

  <!-- ═══ VIEW: COMPARADOR ═══ -->
  <div class="view ativo" id="view-comparador">
    <aside class="painel-jogos">
      <div class="painel-header">
        <div class="search-wrap">
          <span class="icon">🔍</span>
          <input id="busca-jogo" type="text" placeholder="Buscar jogo ou time..." oninput="filtrarJogos()" />
        </div>
        <div class="filtro-comp" id="filtros-comp">
          <span class="chip ativo" onclick="selecionarComp(this,'')">Todos</span>
        </div>
      </div>
      <div class="contador-jogos" id="contador">–</div>
      <div class="lista-jogos" id="lista-jogos">
        <div class="loading">
          <div class="spinner"></div><span>Buscando jogos...</span>
        </div>
      </div>
    </aside>
    <main class="painel-detalhe" id="painel-detalhe">
      <div class="estado-vazio">
        <div class="icone">⚽</div>
        <p>Selecione um jogo para ver as odds de <strong>todas as casas</strong>.</p>
      </div>
    </main>
  </div>

  <!-- ═══ VIEW: FREEBET ═══ -->
  <div class="view" id="view-freebet">
    <div class="fb-wrapper">
      <!-- Config -->
      <div class="fb-config">
        <div class="fb-config-top">
          <div class="fb-titulo">🎟️ Configuração da Freebet</div>
          <div class="fb-casas-count" id="fb-casas-count">28 casas disponíveis</div>
        </div>
        <div class="fb-controles">
          <div class="fb-campo">
            <label>Valor da Freebet (R$)</label>
            <input id="fb-valor" class="fb-input" type="number" value="10" min="1"
              oninput="recalcularFreebetDebounced()" />
          </div>
          <div class="fb-campo">
            <label>ROI mínimo (%)</label>
            <input id="fb-roi-min" class="fb-input" type="number" value="0" min="0" style="width:100px"
              oninput="recalcularFreebetDebounced()" />
          </div>
          <button class="fb-filtros-btn" id="btn-filtros" onclick="toggleFiltros()">⚙ Filtros</button>
        </div>
        <!-- Painel de Filtros avançados -->
        <div class="fb-filtros-painel" id="fb-filtros-painel">
          <div class="fb-filtro-grupo">
            <label>Odd Mínima da Freebet</label>
            <div class="fb-filtro-row">
              <input id="fb-odd-min" class="fb-mini-input" type="number" value="1" min="1" step="0.1"
                oninput="recalcularFreebetDebounced()" />
              <span>até</span>
              <input id="fb-odd-max" class="fb-mini-input" type="number" value="9999" min="1" step="0.1"
                oninput="recalcularFreebetDebounced()" />
            </div>
          </div>
          <div class="fb-filtro-grupo">
            <label>Lucro mínimo (R$)</label>
            <input id="fb-lucro-min" class="fb-mini-input" type="number" value="0" min="0" step="0.1"
              oninput="recalcularFreebetDebounced()" />
          </div>
          <div class="fb-filtro-grupo">
            <label>Tipo de casa (hedge)</label>
            <div class="fb-filtro-row" style="gap:14px">
              <label
                style="display:flex;align-items:center;gap:5px;font-size:.82rem;text-transform:none;letter-spacing:0;color:var(--text)">
                <input type="checkbox" id="fb-mostrar-normais" checked onchange="recalcularFreebet()"> Normais
              </label>
              <label
                style="display:flex;align-items:center;gap:5px;font-size:.82rem;text-transform:none;letter-spacing:0;color:var(--text)">
                <input type="checkbox" id="fb-mostrar-so" checked onchange="recalcularFreebet()"> Super Odd (SO)
              </label>
            </div>
            <span style="font-size:.7rem;color:var(--muted);margin-top:2px">⚠️ Aplica-se às casas de hedge
              (cobertura)</span>
          </div>
          <div class="fb-filtro-grupo" style="min-width:220px;flex:1">
            <label>Campeonatos</label>
            <div style="display:flex;gap:6px;margin-bottom:6px">
              <button class="fb-filtros-btn" style="height:28px;font-size:.72rem;padding:0 10px"
                onclick="selecionarTodasComps(true)">Marcar todos</button>
              <button class="fb-filtros-btn" style="height:28px;font-size:.72rem;padding:0 10px"
                onclick="selecionarTodasComps(false)">Limpar</button>
            </div>
            <div id="fb-comps-lista"
              style="display:flex;flex-direction:column;gap:4px;max-height:160px;overflow-y:auto;padding-right:6px">
              <span style="color:var(--muted);font-size:.78rem">Carregando...</span>
            </div>
          </div>
        </div>
        <!-- Grid de casas -->
        <div class="fb-casas-grid" id="fb-casas-grid"></div>
      </div>
      <!-- Resultados -->
      <div class="fb-resultados-area" id="fb-resultados-area">
        <div class="fb-placeholder" id="fb-placeholder">
          <div class="icon">🎟️</div>
          <h3>Selecione uma casa de apostas</h3>
          <p>Escolha a casa onde você tem a freebet para ver as melhores oportunidades de extração com lucro garantido.
          </p>
        </div>
        <div id="fb-resultados-header" style="display:none" class="fb-resultados-header">
          <div class="fb-resultados-info" id="fb-resultados-info"></div>
        </div>
        <div class="fb-grid" id="fb-grid"></div>
      </div>
    </div>
  </div>

  <script>
    /* ═══════════════════════════════════════
       ESTADO GLOBAL
    ═══════════════════════════════════════ */
    let todosJogos = [];
    let jogoSelecionado = null;
    let compSelecionada = '';
    let sortState = { normal: { coluna: null, dir: 'asc' }, so: { coluna: null, dir: 'asc' } };
    let fbCasaSelecionada = null;
    let abaAtiva = 'comparador';

    const NOMES_CASAS = {
      '7k': '7K', 'aposta1': 'Aposta1', 'aposta1so': 'Aposta1 SO',
      'bet365': 'Bet365', 'bet365so': 'Bet365 SO',
      'betano': 'Betano', 'betanoso': 'Betano SO',
      'betbraso': 'BetBra SO', 'betnacional': 'Betnacional', 'betnacionalso': 'Betnacional SO',
      'betsul': 'Betsul', 'br4': 'Br4',
      'esportesdasorte': 'Esportes da Sorte', 'esportesdasorteso': 'Esportes da Sorte SO',
      'esportiva': 'Esportiva', 'estrelabet': 'Estrelabet', 'estrelabetso': 'Estrelabet SO',
      'kto': 'KTO', 'ktoso': 'KTO SO', 'lotogreen': 'Lotogreen', 'mcgames': 'MC Games',
      'novibet': 'Novibet', 'pixbet': 'Pixbet', 'pixbetso': 'Pixbet SO',
      'sortenabet': 'Sortenabet', 'sportingbet': 'Sportingbet',
      'stake': 'Stake', 'stakeso': 'Stake SO', 'superbet': 'Superbet', 'vaidebetso': 'Vaidebet SO',
    };

    function nomeCasa(id) { return NOMES_CASAS[id] || (id || '').replace(/so$/, ' SO').replace(/\b\w/g, c => c.toUpperCase()); }
    function ehSO(id) { return (id || '').toLowerCase().endsWith('so'); }
    function fmt(v) { return (!v || v === 0) ? '—' : Number(v).toFixed(2); }

    /* ─── Cache do filtro de data ────────────────────────────
       Evita re-parsear data/hora do mesmo jogo várias vezes */
    const _cacheAconteceu = new Map();
    function jogoJaAconteceu(j) {
      if (_cacheAconteceu.has(j.id)) return _cacheAconteceu.get(j.id);
      try {
        if (!j.data || !j.hora) { _cacheAconteceu.set(j.id, false); return false; }
        const [dia, mes] = j.data.split('/').map(Number);
        const [hora, min] = j.hora.split(':').map(Number);
        const agora = new Date();
        const inicioJogo = new Date(agora.getFullYear(), mes - 1, dia, hora, min);
        const resultado = (agora - inicioJogo) > 90 * 60 * 1000;
        _cacheAconteceu.set(j.id, resultado);
        return resultado;
      } catch (e) { _cacheAconteceu.set(j.id, false); return false; }
    }

    /* ─── Debounce ───────────────────────────────────
       Evita recalcular a cada tecla nos inputs de freebet */
    function debounce(fn, ms) {
      let t;
      return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), ms); };
    }
    const recalcularFreebetDebounced = debounce(() => recalcularFreebet(), 300);

    /* ═══════════════════════════════════════
       NAVEGAÇÃO POR ABAS
    ═══════════════════════════════════════ */
    function mudarAba(aba) {
      abaAtiva = aba;
      document.querySelectorAll('.view').forEach(v => v.classList.remove('ativo'));
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('ativo'));
      document.getElementById(`view-${aba}`).classList.add('ativo');
      document.getElementById(`tab-${aba}`).classList.add('ativo');
      if (aba === 'freebet') iniciarFreebet();
    }

    /* ═══════════════════════════════════════
       CARREGAR DADOS DA API
    ═══════════════════════════════════════ */
    async function carregarJogos() {
      document.getElementById('status-pill').textContent = 'Atualizando...';
      document.getElementById('lista-jogos').innerHTML =
        '<div class="loading"><div class="spinner"></div><span>Buscando jogos...</span></div>';

      try {
        const r = await fetch('/api/jogos/todas-casas');
        const data = await r.json();
        const brutos = data.jogos || [];

        // Filtra jogos que já aconteceram (mais de 90 min do início)
        const passados = brutos.filter(j => jogoJaAconteceu(j));
        todosJogos = brutos.filter(j => !jogoJaAconteceu(j));

        const msgPassados = passados.length > 0
          ? ` · ${passados.length} encerrado${passados.length !== 1 ? 's' : ''} ocultado${passados.length !== 1 ? 's' : ''}`
          : '';

        document.getElementById('status-pill').textContent =
          `Atualizado ${new Date().toLocaleTimeString('pt-BR')} · ${todosJogos.length} jogos${msgPassados}`;

        montarChipsComp([...new Set(todosJogos.map(j => j.competicao))].sort());
        renderizarLista(todosJogos);
        popularFiltroComps(); // atualiza filtro de competições da aba freebet

        // Atualiza freebet se aba ativa
        if (abaAtiva === 'freebet') recalcularFreebet();
      } catch (e) {
        document.getElementById('status-pill').textContent = 'Erro ao carregar';
        document.getElementById('lista-jogos').innerHTML =
          '<div class="loading" style="color:#f87171">❌ Servidor não encontrado.</div>';
      }
    }

    /* ═══════════════════════════════════════
       COMPARADOR — LISTA DE JOGOS
    ═══════════════════════════════════════ */
    function montarChipsComp(comps) {
      const el = document.getElementById('filtros-comp');
      el.innerHTML = `<span class="chip ativo" onclick="selecionarComp(this,'')">Todos</span>`;
      comps.slice(0, 12).forEach(c => {
        const s = document.createElement('span');
        s.className = 'chip'; s.dataset.comp = c; s.title = c;
        s.textContent = c.replace(/^.* - /, '');
        s.onclick = () => selecionarComp(s, c);
        el.appendChild(s);
      });
    }
    function selecionarComp(el, comp) {
      document.querySelectorAll('.chip').forEach(c => c.classList.remove('ativo'));
      el.classList.add('ativo'); compSelecionada = comp; filtrarJogos();
    }
    function filtrarJogos() {
      const q = document.getElementById('busca-jogo').value.toLowerCase().trim();
      let lista = todosJogos;
      if (compSelecionada) lista = lista.filter(j => j.competicao === compSelecionada);
      if (q) lista = lista.filter(j => j.partida.toLowerCase().includes(q) || j.competicao.toLowerCase().includes(q));
      renderizarLista(lista);
    }
    function renderizarLista(jogos) {
      const el = document.getElementById('lista-jogos');
      document.getElementById('contador').textContent =
        `${jogos.length} jogo${jogos.length !== 1 ? 's' : ''} encontrado${jogos.length !== 1 ? 's' : ''}`;
      if (!jogos.length) { el.innerHTML = '<div class="loading" style="padding:28px">Nenhum jogo</div>'; return; }
      el.innerHTML = jogos.map(j => {
        const b = j.best || {}; const isA = jogoSelecionado && jogoSelecionado.id === j.id;
        return `<div class="jogo-item ${isA ? 'ativo' : ''}" id="item-${CSS.escape(j.id)}"
      onclick="selecionarJogo(${JSON.stringify(j.id).replace(/"/g, '&quot;')})">
      <div class="jogo-times">${j.partida}</div>
      <div class="jogo-meta"><span>${j.competicao}</span><span class="hora">${j.data} ${j.hora}</span></div>
      <div class="jogo-odds-preview">
        <div class="odd-pill"><span class="label">1</span><span class="val">${fmt(b.casa?.odd)}</span></div>
        <div class="odd-pill"><span class="label">X</span><span class="val">${fmt(b.empate?.odd)}</span></div>
        <div class="odd-pill"><span class="label">2</span><span class="val">${fmt(b.visitante?.odd)}</span></div>
      </div>
      <div class="casas-badge">${j.total_casas} casas</div>
    </div>`;
      }).join('');
    }
    function selecionarJogo(id) {
      jogoSelecionado = todosJogos.find(j => j.id === id);
      if (!jogoSelecionado) return;
      document.querySelectorAll('.jogo-item').forEach(el => el.classList.remove('ativo'));
      const el = document.getElementById(`item-${CSS.escape(id)}`);
      if (el) el.classList.add('ativo');
      sortState = { normal: { coluna: null, dir: 'asc' }, so: { coluna: null, dir: 'asc' } };
      renderizarDetalhe(jogoSelecionado);
    }

    /* ═══════════════════════════════════════
       COMPARADOR — DETALHE / TABELA
    ═══════════════════════════════════════ */
    function ordenarCasas(casas, tipo) {
      const st = sortState[tipo]; if (!st.coluna) return casas;
      return [...casas].sort((a, b) => st.dir === 'asc' ? a[st.coluna] - b[st.coluna] : b[st.coluna] - a[st.coluna]);
    }
    function clicarOrdem(tipo, col) {
      const st = sortState[tipo];
      st.dir = (st.coluna === col) ? (st.dir === 'asc' ? 'desc' : 'asc') : 'desc'; st.coluna = col;
      renderizarDetalhe(jogoSelecionado);
    }
    function iconSort(tipo, col) { const st = sortState[tipo]; if (st.coluna !== col) return '<span class="sort-icon">⇅</span>'; return st.dir === 'desc' ? '<span class="sort-icon">↓</span>' : '<span class="sort-icon">↑</span>'; }
    function thClass(tipo, col) { const st = sortState[tipo]; if (st.coluna !== col) return 'sortable'; return `sortable sort-${st.dir}`; }

    function gerarLinhas(casas, tipo, maximos) {
      const so = tipo === 'so', topCls = so ? 'topo-so' : 'topo-normal';
      const mC = so ? 'melhor-so' : 'melhor', lC = so ? 'linha-topo-so' : 'linha-topo-normal';
      return casas.map(c => {
        const t1 = c.odd1 > 0 && c.odd1 === maximos.odd1, tX = c.oddX > 0 && c.oddX === maximos.oddX, t2 = c.odd2 > 0 && c.odd2 === maximos.odd2;
        const cl1 = t1 ? topCls : (c.isBest1 ? mC : (c.odd1 ? 'normal' : 'zero'));
        const clX = tX ? topCls : (c.isBestX ? mC : (c.oddX ? 'normal' : 'zero'));
        const cl2 = t2 ? topCls : (c.isBest2 ? mC : (c.odd2 ? 'normal' : 'zero'));
        const tB = c.isBest1 || c.isBestX || c.isBest2, tT = t1 || tX || t2;
        const dot = ((tT || tB) ? (so ? 'dot-best-so' : 'dot-best') : 'dot-normal');
        const trC = [tB ? 'is-best' : '', tT ? lC : ''].filter(Boolean).join(' ');
        const link = c.href ? `<a class="btn-link" href="${c.href}" target="_blank" rel="noopener">Abrir →</a>` : `<span style="color:var(--muted);font-size:.74rem">—</span>`;
        return `<tr class="${trC}"><td><div class="td-casa"><span class="${dot}"></span>${c.nome_display}</div></td>
      <td class="td-odd ${cl1}">${c.odd1 ? fmt(c.odd1) : '—'}</td>
      <td class="td-odd ${clX}">${c.oddX ? fmt(c.oddX) : '—'}</td>
      <td class="td-odd ${cl2}">${c.odd2 ? fmt(c.odd2) : '—'}</td>
      <td style="text-align:center">${link}</td></tr>`;
      }).join('');
    }
    function gerarTabela(casas, tipo) {
      if (!casas.length) return '';
      const o = ordenarCasas(casas, tipo), w = tipo === 'so' ? 'tabela-wrap so' : 'tabela-wrap';
      const v = casas.filter(c => c.odd1 > 0 || c.oddX > 0 || c.odd2 > 0);
      const mx = { odd1: Math.max(...v.map(c => c.odd1 || 0)), oddX: Math.max(...v.map(c => c.oddX || 0)), odd2: Math.max(...v.map(c => c.odd2 || 0)) };
      return `<div class="${w}"><table><thead><tr><th>Casa de Apostas</th>
    <th class="${thClass(tipo, 'odd1')}" onclick="clicarOrdem('${tipo}','odd1')">1 (Casa)${iconSort(tipo, 'odd1')}</th>
    <th class="${thClass(tipo, 'oddX')}" onclick="clicarOrdem('${tipo}','oddX')">X (Empate)${iconSort(tipo, 'oddX')}</th>
    <th class="${thClass(tipo, 'odd2')}" onclick="clicarOrdem('${tipo}','odd2')">2 (Visit.)${iconSort(tipo, 'odd2')}</th>
    <th style="text-align:center">Link</th></tr></thead>
    <tbody>${gerarLinhas(o, tipo, mx)}</tbody></table></div>`;
    }
    function renderizarDetalhe(jogo) {
      const best = jogo.best || {}, casas = jogo.casas || [];
      const b1 = best.casa || {}, bX = best.empate || {}, b2 = best.visitante || {};
      const nB = arr => (arr || []).map(c => c.replace(/so$/, ' SO').toUpperCase()).join(', ') || '—';
      const cn = casas.filter(c => !ehSO(c.bookmaker)), cs = casas.filter(c => ehSO(c.bookmaker));
      document.getElementById('painel-detalhe').innerHTML = `
    <div class="detalhe-header">
      <div class="detalhe-partida">${jogo.partida}</div>
      <div class="detalhe-meta">
        <span>⚽ ${jogo.competicao}</span><span>📅 ${jogo.data}</span>
        <span>🕐 ${jogo.hora}</span><span>🏬 ${cn.length} normais + ${cs.length} SO</span>
      </div>
      <div class="tag-best">
        <span class="label">Melhor 1:</span><span class="val">${fmt(b1.odd)}</span><span class="casa">${nB(b1.bookmakers)}</span>
        &nbsp;·&nbsp;
        <span class="label">Melhor X:</span><span class="val">${fmt(bX.odd)}</span><span class="casa">${nB(bX.bookmakers)}</span>
        &nbsp;·&nbsp;
        <span class="label">Melhor 2:</span><span class="val">${fmt(b2.odd)}</span><span class="casa">${nB(b2.bookmakers)}</span>
      </div>
    </div>
    <div class="secao-titulo">
      <h3 style="color:var(--green)">Casas Normais</h3>
      <span class="pill-normal">${cn.length} casas</span>
      <span class="legenda">· Pagamento Antecipado · clique na coluna para ordenar</span>
    </div>
    ${gerarTabela(cn, 'normal')}
    ${cs.length ? `
    <div class="secao-titulo">
      <h3 style="color:var(--orange)">Super Odd (SO)</h3>
      <span class="pill-so">${cs.length} casas</span>
      <span class="legenda">· Odds boosted · sempre maiores que as normais</span>
    </div>
    ${gerarTabela(cs, 'so')}` : ''}`;
    }

    /* ═══════════════════════════════════════
       FREEBET — LÓGICA PRINCIPAL
    ═══════════════════════════════════════ */
    const LISTA_CASAS_FREEBET = Object.entries(NOMES_CASAS).map(([id, nome]) => ({ id, nome }));

    function iniciarFreebet() {
      renderizarBotoesCasas();
      if (!fbCasaSelecionada) {
        document.getElementById('fb-placeholder').style.display = 'flex';
        document.getElementById('fb-resultados-header').style.display = 'none';
        document.getElementById('fb-grid').innerHTML = '';
      }
    }

    function renderizarBotoesCasas() {
      const el = document.getElementById('fb-casas-grid');
      const mostrarNormais = document.getElementById('fb-mostrar-normais')?.checked !== false;
      const mostrarSO = document.getElementById('fb-mostrar-so')?.checked !== false;
      el.innerHTML = LISTA_CASAS_FREEBET.filter(c => {
        if (ehSO(c.id)) return mostrarSO;
        return mostrarNormais;
      }).map(c => `
    <button class="fb-casa-btn ${fbCasaSelecionada === c.id ? 'ativo' : ''}"
      onclick="selecionarCasaFreebet('${c.id}')">${c.nome}</button>
  `).join('');
    }

    function selecionarCasaFreebet(id) {
      fbCasaSelecionada = (fbCasaSelecionada === id) ? null : id;
      renderizarBotoesCasas();
      recalcularFreebet();
    }

    function toggleFiltros() {
      const p = document.getElementById('fb-filtros-painel');
      const b = document.getElementById('btn-filtros');
      p.classList.toggle('aberto');
      b.classList.toggle('ativo');
    }

    function calcROI(oddFB, oddA, oddB, valorFB) {
      if (oddFB <= 1 || oddA <= 1 || oddB <= 1) return null;
      const target = (oddFB - 1) * valorFB;
      const sA = target / oddA, sB = target / oddB;
      const custo = sA + sB, lucro = target - custo, roi = (lucro / valorFB) * 100;
      return { roi, lucro, custo, sA, sB, target };
    }

    /* Retorna o melhor odd e nome da casa para um outcome, dentro de um conjunto de casas */
    function melhorOdd(casasHedge, campo) {
      let best = { odd: 0, nome: '' };
      for (const c of casasHedge) {
        const v = c[campo] || 0;
        if (v > best.odd) best = { odd: v, nome: c.nome_display || nomeCasa(c.bookmaker) };
      }
      return best;
    }

    /* hedgeCasas: lista de casas já filtrada por tipo (Normal/SO) */
    function calcularFreebetJogo(jogo, bookmakerID, valorFB, hedgeCasas) {
      const casas = jogo.casas || [];
      const casaSel = casas.find(c => c.bookmaker === bookmakerID);
      if (!casaSel) return null;

      /* Usando as casas de hedge passadas (já filtradas por tipo Normal/SO).  
         Exclui a própria casa da freebet do hedge. */
      const hedge = hedgeCasas.filter(c => c.bookmaker !== bookmakerID);
      if (!hedge.length) return null;

      const m1 = melhorOdd(hedge, 'odd1');
      const mX = melhorOdd(hedge, 'oddX');
      const m2 = melhorOdd(hedge, 'odd2');

      let melhor = null;
      // Freebet em Casa (1)
      if (casaSel.odd1 > 1 && mX.odd > 1 && m2.odd > 1) {
        const r = calcROI(casaSel.odd1, mX.odd, m2.odd, valorFB);
        if (r && (!melhor || r.roi > melhor.roi)) melhor = {
          ...r, outcomeFB: 'Casa', oddFB: casaSel.odd1,
          hedgeA: { label: 'Empate', odd: mX.odd, nome: mX.nome, stake: r.sA },
          hedgeB: { label: 'Visitante', odd: m2.odd, nome: m2.nome, stake: r.sB }
        };
      }
      // Freebet em Empate (X)
      if (casaSel.oddX > 1 && m1.odd > 1 && m2.odd > 1) {
        const r = calcROI(casaSel.oddX, m1.odd, m2.odd, valorFB);
        if (r && (!melhor || r.roi > melhor.roi)) melhor = {
          ...r, outcomeFB: 'Empate', oddFB: casaSel.oddX,
          hedgeA: { label: 'Casa', odd: m1.odd, nome: m1.nome, stake: r.sA },
          hedgeB: { label: 'Visitante', odd: m2.odd, nome: m2.nome, stake: r.sB }
        };
      }
      // Freebet em Visitante (2)
      if (casaSel.odd2 > 1 && m1.odd > 1 && mX.odd > 1) {
        const r = calcROI(casaSel.odd2, m1.odd, mX.odd, valorFB);
        if (r && (!melhor || r.roi > melhor.roi)) melhor = {
          ...r, outcomeFB: 'Visitante', oddFB: casaSel.odd2,
          hedgeA: { label: 'Casa', odd: m1.odd, nome: m1.nome, stake: r.sA },
          hedgeB: { label: 'Empate', odd: mX.odd, nome: mX.nome, stake: r.sB }
        };
      }

      if (!melhor) return null;
      return { ...melhor, jogo, bookmakerNome: nomeCasa(bookmakerID) };
    }

    /* Popula os checkboxes de campeonato no painel de filtros */
    function popularFiltroComps() {
      const el = document.getElementById('fb-comps-lista');
      if (!el) return;
      const comps = [...new Set(todosJogos.map(j => j.competicao))].sort();
      el.innerHTML = comps.map(c => `
        <label style="display:flex;align-items:center;gap:6px;font-size:.8rem;color:var(--text);cursor:pointer;white-space:nowrap">
          <input type="checkbox" class="fb-comp-check" value="${c.replace(/"/g, '&quot;')}" checked
            onchange="recalcularFreebet()" />
          ${c.replace(/^.* - /, '')} <span style="color:var(--muted);font-size:.71rem">(${todosJogos.filter(j => j.competicao === c).length})</span>
        </label>
      `).join('');
    }

    function selecionarTodasComps(marcar) {
      document.querySelectorAll('.fb-comp-check').forEach(cb => cb.checked = marcar);
      recalcularFreebet();
    }

    function recalcularFreebet() {
      renderizarBotoesCasas();
      if (!fbCasaSelecionada) {
        document.getElementById('fb-placeholder').style.display = 'flex';
        document.getElementById('fb-resultados-header').style.display = 'none';
        document.getElementById('fb-grid').innerHTML = ''; return;
      }
      const valorFB = parseFloat(document.getElementById('fb-valor').value) || 10;
      const minROI = parseFloat(document.getElementById('fb-roi-min').value) || 0;
      const oddMin = parseFloat(document.getElementById('fb-odd-min')?.value) || 1;
      const oddMax = parseFloat(document.getElementById('fb-odd-max')?.value) || 9999;
      const lucroMin = parseFloat(document.getElementById('fb-lucro-min')?.value) || 0;
      const mostrarNormais = document.getElementById('fb-mostrar-normais')?.checked !== false;
      const mostrarSO = document.getElementById('fb-mostrar-so')?.checked !== false;

      // Competições selecionadas (vazio = todas)
      const compChecks = [...document.querySelectorAll('.fb-comp-check')];
      const compsSel = compChecks.length
        ? new Set(compChecks.filter(cb => cb.checked).map(cb => cb.value))
        : null;

      let jogosParaCalc = todosJogos;
      if (compsSel && compsSel.size < compChecks.length) {
        jogosParaCalc = todosJogos.filter(j => compsSel.has(j.competicao));
      }

      let resultados = jogosParaCalc.map(jogo => {
        // Monta a lista de casas de hedge filtrada por tipo
        let hedgeCasas = jogo.casas || [];
        if (!mostrarNormais) hedgeCasas = hedgeCasas.filter(c => ehSO(c.bookmaker));
        else if (!mostrarSO) hedgeCasas = hedgeCasas.filter(c => !ehSO(c.bookmaker));
        return calcularFreebetJogo(jogo, fbCasaSelecionada, valorFB, hedgeCasas);
      })
        .filter(r => r && r.roi >= minROI && r.lucro >= lucroMin && r.oddFB >= oddMin && r.oddFB <= oddMax)
        .sort((a, b) => b.roi - a.roi);

      document.getElementById('fb-placeholder').style.display = 'none';
      const hdr = document.getElementById('fb-resultados-header');
      hdr.style.display = 'flex';
      document.getElementById('fb-resultados-info').innerHTML =
        `Freebet em <strong>${nomeCasa(fbCasaSelecionada)}</strong> · R$ ${valorFB.toFixed(2)} · <strong>${resultados.length} oportunidades</strong> encontradas`;

      document.getElementById('fb-grid').innerHTML = resultados.map(r => renderCardFreebet(r, valorFB)).join('');
    }

    function renderCardFreebet(r, valorFB) {
      const { jogo, roi, lucro, custo, outcomeFB, oddFB, hedgeA, hedgeB, bookmakerNome } = r;
      const roiCls = roi > 50 ? 'alto' : roi > 15 ? 'medio' : 'baixo';
      // ordena as 3 linhas: hedge A, hedge B, freebet por último
      return `
  <div class="fb-card">
    <div class="fb-card-header">
      <span class="fb-match-icon">⚽</span>
      <div class="fb-match-info">
        <div class="fb-match-name">${jogo.partida}</div>
        <div class="fb-match-comp">${jogo.competicao} · ${jogo.data} ${jogo.hora}</div>
      </div>
      <div class="fb-roi-badge ${roiCls}">${roi.toFixed(1)}% ROI</div>
    </div>
    <div class="fb-card-summary">
      <span>Total a investir: <strong>R$ ${custo.toFixed(2)}</strong></span>
      <span>Lucro garantido: <strong class="fb-lucro-val">R$ ${lucro.toFixed(2)}</strong></span>
    </div>
    <div class="fb-card-bets">
      <div class="fb-bet">
        <div><div class="fb-bet-casa">${hedgeA.nome}</div><div class="fb-bet-outcome">${hedgeA.label}</div></div>
        <div class="fb-bet-odd">odd <span>${hedgeA.odd.toFixed(2)}</span></div>
        <div class="fb-bet-valor">R$ ${hedgeA.stake.toFixed(2)}</div>
      </div>
      <div class="fb-bet">
        <div><div class="fb-bet-casa">${hedgeB.nome}</div><div class="fb-bet-outcome">${hedgeB.label}</div></div>
        <div class="fb-bet-odd">odd <span>${hedgeB.odd.toFixed(2)}</span></div>
        <div class="fb-bet-valor">R$ ${hedgeB.stake.toFixed(2)}</div>
      </div>
      <div class="fb-bet is-freebet">
        <div>
          <div class="fb-bet-casa"><span class="fb-casa-dot"></span>${bookmakerNome}</div>
          <div class="fb-bet-outcome">${outcomeFB}</div>
        </div>
        <div class="fb-bet-odd">odd <span>${oddFB.toFixed(2)}</span></div>
        <div class="fb-bet-valor">R$ ${valorFB.toFixed(2)}<span class="fb-freebet-tag">FREEBET</span></div>
      </div>
    </div>
  </div>`;
    }

    /* ─── Init ─── */
    carregarJogos();
  </script>
</body>

</html>